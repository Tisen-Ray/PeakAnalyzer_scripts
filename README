# PeakAnalyzer Scripts - å³°åˆ†æå™¨

è¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºStreamlit +  Python + Rust çš„è´¨è°±æ•°æ®å³°åˆ†æå·¥å…·ï¼Œå€ŸåŠ©äº mzdata æ¥è¯»å–è´¨è°±ä¿¡æ¯
å°è¯•æä¾›è‡ªç”±æ§åˆ¶,ä¸”æ”¯æŒæ‰¹é‡æ•°æ®æ“ä½œçš„è‰²è°±å³°åˆ†æ
ç”¨äºè§£å†³Thermo å®˜æ–¹è½¯ä»¶éœ€è¦è¿‡å¤šäººå·¥å¹²é¢„çš„é—®é¢˜

ä»¥ä¸‹éƒ¨ç½²æ–¹æ¡ˆç³»AIç”Ÿæˆ, è¯·æ‚¨æ˜è¾¨

## ğŸš€ å¿«é€Ÿéƒ¨ç½²æŒ‡å—ï¼ˆä½¿ç”¨ uvï¼‰

### å‰ç½®è¦æ±‚

1. **Python 3.10+**
2. **Rust å·¥å…·é“¾** (ç”¨äºç¼–è¯‘ Rust æ‰©å±•)
3. **uv** åŒ…ç®¡ç†å™¨
4. **Git**

### æ­¥éª¤ 1: å®‰è£…ä¾èµ–å·¥å…·

#### Windows ç”¨æˆ·ï¼š

```powershell
# 1. å®‰è£… uv
curl -LsSf https://astral.sh/uv/install.ps1 | powershell

# 2. å®‰è£… Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
# é‡å¯ç»ˆç«¯æˆ–è¿è¡Œ: $env:PATH += ";$env:USERPROFILE\.cargo\bin"

# 3. å®‰è£… .NET 8.0 Runtime (ç”¨äº Thermo RAW æ–‡ä»¶æ”¯æŒ)
# è®¿é—®: https://dotnet.microsoft.com/download/dotnet/8.0
```

#### Linux/macOS ç”¨æˆ·ï¼š

```bash
# 1. å®‰è£… uv
curl -LsSf https://astral.sh/uv/install.sh | sh

# 2. å®‰è£… Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source ~/.cargo/env

# 3. å®‰è£… .NET 8.0 Runtime (Linux)
wget https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb -O packages-microsoft-prod.deb
sudo dpkg -i packages-microsoft-prod.deb
sudo apt-get update && sudo apt-get install -y dotnet-runtime-8.0
```

### æ­¥éª¤ 2: å…‹éš†å¹¶éƒ¨ç½²é¡¹ç›®

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <é¡¹ç›®åœ°å€>
cd PeakAnalyzer_scripts

# 2. ä½¿ç”¨ uv åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£… Python ä¾èµ–
uv venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate

# 3. å®‰è£… Python ä¾èµ–
uv pip install -r python/requirements.txt

# 4. ç¼–è¯‘ Rust æ‰©å±•æ¨¡å—
cd python
uv pip install maturin
maturin develop --release

# 5. éªŒè¯å®‰è£…
python -c "import peakanalyzer_scripts; print('âœ… Rust æ¨¡å—å®‰è£…æˆåŠŸ')"
```

### æ­¥éª¤ 3: å¯åŠ¨åº”ç”¨

```bash
# åœ¨ python ç›®å½•ä¸‹å¯åŠ¨
cd python
streamlit run main.py

# æˆ–ä½¿ç”¨ä¾¿æ·å¯åŠ¨è„šæœ¬
python start.py
```

åº”ç”¨å°†åœ¨ `http://localhost:8501` å¯åŠ¨ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
PeakAnalyzer_scripts/
â”œâ”€â”€ README                    # æœ¬æ–‡æ¡£
â”œâ”€â”€ Cargo.toml               # Rust é¡¹ç›®é…ç½®
â”œâ”€â”€ pyproject.toml           # Python é¡¹ç›®é…ç½®
â”œâ”€â”€ uv.lock                  # uv é”å®šæ–‡ä»¶
â”œâ”€â”€ src/                     # Rust æºä»£ç 
â”‚   â”œâ”€â”€ lib.rs              # Rust ä¸»æ¨¡å—
â”‚   â”œâ”€â”€ curve.rs            # æ›²çº¿æ•°æ®ç»“æ„
â”‚   â”œâ”€â”€ data_loader.rs      # æ•°æ®åŠ è½½å™¨
â”‚   â””â”€â”€ curve_extractor.rs  # æ›²çº¿æå–å™¨
â””â”€â”€ python/                  # Python æºä»£ç 
    â”œâ”€â”€ main.py             # ä¸»å…¥å£
    â”œâ”€â”€ requirements.txt    # Python ä¾èµ–
    â”œâ”€â”€ core/               # æ ¸å¿ƒæ¨¡å—
    â”œâ”€â”€ ui/                 # ç”¨æˆ·ç•Œé¢
    â”œâ”€â”€ peak_analysis/      # å³°åˆ†æç®—æ³•
    â”œâ”€â”€ export/             # å¯¼å‡ºåŠŸèƒ½
    â””â”€â”€ utils/              # å·¥å…·å‡½æ•°
```

## ğŸ”§ åŠŸèƒ½ç‰¹æ€§

### æ•°æ®æå–
- **æ”¯æŒæ ¼å¼**: mzML, mzXML, MGF, Thermo RAW
- **æ›²çº¿ç±»å‹**: TIC (æ€»ç¦»å­æµ), BPC (åŸºå³°è‰²è°±), XIC (æå–ç¦»å­è‰²è°±)
- **æ‰¹é‡å¤„ç†**: å¤šæ–‡ä»¶åŒæ—¶å¤„ç†

### æ›²çº¿å¤„ç†
- **åŸºçº¿æ ¡æ­£**: çº¿æ€§ã€å¤šé¡¹å¼ã€ä¸å¯¹ç§°æœ€å°äºŒä¹˜ã€è‡ªé€‚åº”
- **å¹³æ»‘å¤„ç†**: ç§»åŠ¨å¹³å‡ã€Savitzky-Golayã€é«˜æ–¯æ»¤æ³¢ã€ä¸­å€¼æ»¤æ³¢ã€ä½é€šæ»¤æ³¢
- **å³°æ£€æµ‹**: scipy_find_peaksã€CWTã€å¯¼æ•°æ³•ã€é˜ˆå€¼æ³•
- **å³°åˆ†æ**: é¢ç§¯ç§¯åˆ†ã€FWHM è®¡ç®—ã€è‰²è°±è´¨é‡å‚æ•°
- **å³°æ‹Ÿåˆ**: é«˜æ–¯ã€æ´›ä¼¦å…¹ã€Voigtã€æŒ‡æ•°ä¿®æ­£é«˜æ–¯ç­‰æ¨¡å‹

### è‰²è°±è´¨é‡å‚æ•°
- **ç†è®ºå¡”æ¿æ•°** (Theoretical Plates)
- **æ‹–å°¾å› å­** (Tailing Factor, USP)
- **ä¸å¯¹ç§°å› å­** (Asymmetry Factor, USP)
- **åˆ†ç¦»åº¦** (Resolution, USP)
- **å®¹é‡å› å­** (Capacity Factor)
- **é€‰æ‹©æ€§å› å­** (Selectivity Factor)

### å¯è§†åŒ–ä¸å¯¼å‡º
- **å¤šæ›²çº¿å¯¹æ¯”**: å åŠ è§†å›¾ã€åˆ†ç¦»è§†å›¾ã€å¯¹æ¯”è§†å›¾
- **äº¤äº’å¼å›¾è¡¨**: Plotly.js é©±åŠ¨çš„ç¼©æ”¾ã€å¹³ç§»ã€æ ‡æ³¨
- **æ‰¹é‡å¤„ç†**: æ™ºèƒ½å‚æ•°å¤ç”¨ï¼Œè¿›åº¦è·Ÿè¸ª
- **æ•°æ®å¯¼å‡º**: CSVã€Excelã€JSON æ ¼å¼

## âš™ï¸ é«˜çº§é…ç½®

### Thermo RAW æ–‡ä»¶æ”¯æŒ

å¦‚æœéœ€è¦å¤„ç† Thermo RAW æ–‡ä»¶ï¼Œè¯·ç¡®ä¿ï¼š

1. **å®‰è£… .NET 8.0 Runtime**:
   ```bash
   # Windows
   winget install Microsoft.DotNet.Runtime.8
   
   # Linux
   sudo apt-get install dotnet-runtime-8.0
   ```

2. **éªŒè¯ .NET å®‰è£…**:
   ```bash
   dotnet --version  # åº”æ˜¾ç¤º 8.x.x
   ```

### æ€§èƒ½ä¼˜åŒ–

1. **Rust Release æ¨¡å¼ç¼–è¯‘**:
   ```bash
   maturin develop --release
   ```

2. **å†…å­˜è®¾ç½®** (å¯¹äºå¤§æ–‡ä»¶):
   ```bash
   export STREAMLIT_SERVER_MAX_UPLOAD_SIZE=1000
   ```

### è‡ªå®šä¹‰é…ç½®

ç¼–è¾‘ `python/.streamlit/config.toml`:

```toml
[server]
port = 8501
maxUploadSize = 1000

[theme]
primaryColor = "#1f77b4"
backgroundColor = "#ffffff"
```

## ğŸ› å¸¸è§é—®é¢˜

### 1. Rust æ¨¡å—ç¼–è¯‘å¤±è´¥
```bash
# æ¸…ç†å¹¶é‡æ–°ç¼–è¯‘
cargo clean
maturin develop --release
```

### 2. RAW æ–‡ä»¶æ— æ³•è¯†åˆ«
- ç¡®ä¿å®‰è£…äº† .NET 8.0 Runtime
- æ£€æŸ¥æ–‡ä»¶è·¯å¾„ä¸­æ— ç‰¹æ®Šå­—ç¬¦
- è€ƒè™‘ä½¿ç”¨ ProteoWizard è½¬æ¢ä¸º mzML

### 3. å†…å­˜ä¸è¶³
- å‡å°‘åŒæ—¶å¤„ç†çš„æ–‡ä»¶æ•°é‡
- å¢åŠ ç³»ç»Ÿè™šæ‹Ÿå†…å­˜
- ä½¿ç”¨æ•°æ®æŠ½æ ·åŠŸèƒ½

### 4. ç«¯å£å†²çª
```bash
streamlit run main.py --server.port 8502
```

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬å·¥ä½œæµç¨‹

1. **æ•°æ®æå–**: ä¸Šä¼  `.mzML` æ–‡ä»¶ â†’ é€‰æ‹©æå–ç±»å‹ (TIC/BPC/XIC) â†’ æå–æ›²çº¿
2. **æ›²çº¿å¤„ç†**: åŸºçº¿æ ¡æ­£ â†’ å¹³æ»‘å¤„ç† â†’ å³°æ£€æµ‹ â†’ å³°åˆ†æ â†’ å³°æ‹Ÿåˆ
3. **ç»“æœå¯è§†åŒ–**: å¤šæ›²çº¿å¯¹æ¯” â†’ è¯¦ç»†å³°æ•°æ®è¡¨æ ¼ â†’ å¯¼å‡ºç»“æœ

### æ‰¹é‡å¤„ç†

1. åœ¨"ç»“æœå¯è§†åŒ–"é¡µé¢é€‰æ‹©"æ‰¹é‡å¤„ç†"æ ‡ç­¾
2. é€‰æ‹©è¦å¤„ç†çš„æ›²çº¿
3. ç³»ç»Ÿè‡ªåŠ¨å¤ç”¨ä¹‹å‰è®¾ç½®çš„å‚æ•°
4. ä¸€é”®æ‰§è¡Œæ‰¹é‡å¤„ç†

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯: `git checkout -b feature/new-feature`
3. æäº¤æ›´æ”¹: `git commit -am 'Add new feature'`
4. æ¨é€åˆ†æ”¯: `git push origin feature/new-feature`
5. æäº¤ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ”— ç›¸å…³é“¾æ¥

- **mzdata**: Rust è´¨è°±æ•°æ®è¯»å–åº“
- **Streamlit**: Python Web åº”ç”¨æ¡†æ¶
- **Plotly**: äº¤äº’å¼å›¾è¡¨åº“
- **uv**: ç°ä»£ Python åŒ…ç®¡ç†å™¨

---

**æŠ€æœ¯æ”¯æŒ**: å¦‚é‡é—®é¢˜ï¼Œè¯·åœ¨ GitHub Issues ä¸­åé¦ˆã€‚